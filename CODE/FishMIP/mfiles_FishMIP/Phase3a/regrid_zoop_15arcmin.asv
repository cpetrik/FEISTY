% regrid 1/4 files form Xiao to regular 1/4 grid
% to match up with ISIMIP vars for tp, tb, det, etc. 
% Xiao: 1440x1080, ISIMIP: 1440x720

clear
close all

fpath='/Volumes/petrik-lab/Feisty/GCM_Data/MOM6-COBALTv2_reanalysis/';
cpath='/Volumes/petrik-lab/Feisty/Fish-MIP/Phase3/QuarterDeg/';
rpath='/Volumes/petrik-lab/Feisty/Fish-MIP/Phase3/GFDL_reanalysis/';


load([fpath 'gfdl-mom6-cobalt2_15arcmin_mdz_lgz_100m_global_monthly_1961_2010.mat'])
load([fpath 'gfdl-mom6_cobalt2_15arcmin_HPloss_mdz_lgz_100m_month_1961_2010.mat'])
% HPloss off by 1e-3

load([rpath 'gridspec_gfdl-mom6-cobalt2_obsclim_15arcmin_orig.mat'])
%load([cpath 'gridspec_gfdl-mom6-cobalt2_obsclim_deptho_15arcmin.mat'])
%[cpath 'gfdl-mom6-cobalt2_obsclim_zmeso100_15arcmin_global_monthly_1961_2010.mat'];
%[cpath 'Data_gfdl_mom6_cobalt2_obsclim_15arcmin_daily_2010.mat'];

%%
[ni,nj] = size(LON);
[zi,zj] = size(glon);

WID = GRD.ID;
NID = GRD.N;

%%
nt = length(yr);
MZ = zeros(zi,zj,nt);
LZ = MZ;
hpMZ = MZ;
hpLZ = MZ;

%%
F = scatteredInterpolant(x,y,v); %scattered interp of old grid
vq = F(xq,yq); 

%%

for t=1:nt
    clear testD testF testP
    
    test1 = griddata(LonD,LatD,nmdz_100(:,:,t),LON,LAT);
    MZ(:,:,t) = test1(WID);
    
    test2 = griddata(LonF,LatF,nlgz_100(:,:,t),LON,LAT);
    LZ(:,:,t) = test2(WID);
    
    test3 = griddata(LonP,LatP,hploss_nmdz_100(:,:,t),LON,LAT);
    hpMZ(:,:,t) = test3(WID);

    test4 = griddata(LonP,LatP,hploss_nlgz_100(:,:,t),LON,LAT);
    hpLZ(:,:,t) = test4(WID);
end


