% !TEX TS-program = pdflatex
\documentclass[12pt,letter]{article}

\renewcommand{\familydefault}{\sfdefault}
\setlength{\parindent}{0pt} 
\setlength{\parskip}{4ex}
\headsep = 35pt

\usepackage[margin=2.9cm]{geometry}
\usepackage[usenames,dvipsnames]{color}
\usepackage[mathlines]{lineno}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{gensymb}
\usepackage{bibentry}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{lastpage} 
\usepackage{wrapfig}
\usepackage[footnotesize]{caption}
\usepackage{subfig}
\usepackage{booktabs}
\usepackage{soul}
\usepackage{epsfig}
\usepackage{cite}
\usepackage[]{natbib}


\usepackage[compact]{titlesec}
\titlespacing{\section}{0pt}{*0}{*-3}
\titlespacing{\subsection}{0pt}{*0}{*-3}
\titlespacing{\subsubsection}{0pt}{*0}{*-3}


%----------------------------------------------------------------------------------
\begin{document}
\setstretch{1.8}

\begin{center}
	{\Huge{The Princeton Ocean Ecosystem Model (POEM)}}\\
	{\color{RoyalBlue}{{James R. Watson$^{1,2}$}}}\\
\end{center}



\footnotesize{

$^1$Stockholm Resilience Centre, Stockholm University. \\
%$^3$NOAA Geophysical Fluid Dynamics Laboratory, Princeton NJ 08544, USA.\\ 
%$^*$Author for correspondence: james.watson@su.se\\
\\
%\textbf{Keywords}: regime shift, tipping point, food web, fisheries, size-spectra, macroecology, climate change.

}
%----------------------------------------------------------------------------------



%----------------------------------------------------------------------------------
\setstretch{2}
\clearpage
\linenumbers

%----------------------------------------------------------------------------------
% Header
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[R]{\footnotesize{Page \thepage\ of \pageref{LastPage}}}
\renewcommand{\headrulewidth}{0cm}
\lhead{\footnotesize{\textit{POEM}}}
\rhead{\footnotesize{\textit{Watson et al.}}}


%----------------------------------------------------------------------------------
\section*{The Model}
The Princeton Ocean Ecosystem Model (POEM) has two main components: (1) the Carbon, Ocean Biogeochemistry and Lower Trophics (COBALT) marine ecosystem model and (2) a size-structured model of high-trophic level dynamics. 

\subsection*{COBALT}
COBALT is used to provide the biogeochemical and planktonic food web dynamics for the size-structured food web model herein.  COBALT uses 33 state variables to resolve global-scale cycles of nitrogen, carbon, phosphate, silicate, iron, calcium carbonate, oxygen, and lithogenic material. COBALT is run as part of the Modular Ocean Model (MOM) version 4.1, with 60 year simulations (1948-2008) forced by the Common Ocean-Ice Reference Experiment (CORE-II) data set as well as a future scenario running from 2006 to 2100 using relative concentration pathways (rcp) 8.5 as the carbon emissions scenario. The horizontal resolution of the simulation is $1^o$ Latitude/Longitude, except along the equator where the resolution is refined to $1/3^o$. The model uses 50 vertical layers, with a resolution of 10m over the top 200m. The representation of planktonic food web dynamics within COBALT includes small and large phytoplankton Ð with the latter group comprised of diatoms and dinoflagellates, and three zooplankton groups that feed on phytoplankton, bacteria and each other according to mean predator prey size ratios. The ``small'' zooplankton group represents microzooplankton that are $< 200 \mu m$ in equivalent spherical diameter (ESD).  The medium zooplankton are parameterized as small to medium bodied copepods ($0.2-2 mm$ ESD), and the large zooplankton are parameterized as large copepods/krill ($2-20 mm$ ESD). The parameterization of trophic interactions relies primarily on the allometric and bioenergetics relationships described in, and the model was calibrated to ensure quantitative consistency with large-scale planktonc food web dynamics, including patterns in primary and meso-zooplankton production. COBALT estimates zooplankton mortality rates using a density dependent closure term. This mortality term accounts for all zooplankton production that is not consumed by other zooplankton, and hence represents feeding by higher predators and other sources of mortality that are not resolved explicitly. This density dependence has empirical support and reflects an assumption that the biomass of predators responds to the biomass of prey. 

COBALT is linked to the size-structured food web model described herein in an ``off-line'' fashion. That is the biomass abundance and mortality rates of zooplankton (to fish) from COBALT are used to drive the dynamics of the size-structured food web model. Furthermore, the rate of detrital flux to the sea-floor is used to drive a benthic size-structured food-web model. The size-structured food-web model is comprised of three major animal groups: planktivorous fish, piscivorous fish and benthic invertebrates. The dynamics of these groups are all modeled using the size-structured formulation of Van Leeuwan et al. 2008 (How Cod Shapes its World). Each group (planktivore, piscivore, detrivore)  is modeled as a collection of size-classes, with smaller classes growing (somatically) into larger size classes. The size-structured model is the same across groups, but with difference in dynamics governed by the choice of parameters.

\subsection*{Size-Structured Ecosystem Model}
The general form of the size-structure model, which is applied to each the planktivore, piscivore and detrivore groups, is as follows. The rate of change of biomass density ($g$ $m^{-2}$) for the smallest size classes indexed 1: 
\begin{equation}
B_1^*= B_1^t + \sum_{j\neq 1}^{N-1}(1-\kappa_j)\nu_j B_j^t - \kappa_1 \gamma_1 B_1^t - d_1 B_1^t,
\end{equation}
where first term on the right-hand-side is the total amount of newborn biomass (i.e. summed over all larger size classes: $j\neq i$) recruiting to the smallest size-class. $\nu_i$ is the total energy available for growth and $\kappa$ is a unit-less parameter that controls the fraction of $\nu$ used for somatic growth, hence $1-\kappa_j$ is the energy invested in the production of larvae/eggs for each size-class $j$. The total amount of newborn biomass recruiting to the first size-class is hence the summation of larvae/egg production over all larger size-classes ($j\neq i$). The second term is the loss of biomass (of size-class 1) due to somatic growth or maturation, where $\gamma$ is a function of $\nu$ that accounts for the loss of biomass within a size-class. The last term is the loss of biomass due to natural mortality. 

For any larger size class of any group, the rate of change of biomass is:  
\begin{equation}
B_i^* = B_i^n + \kappa_{i-1} \gamma_{i-1} B_{i-1} - \kappa_i \gamma_i B_i - (1-\kappa_i) \nu_i B_i - d_i B_i,
\end{equation}
for $i=2,...,N$. Here, the first term on the right-hand-side is maturing biomass from the previous size-class, the second term is the loss of biomass due to somatic growth, the third term is the loss of biomass to egg/larvae production and the last term is the loss of biomass due to natural mortality. Note, there is no recruitment term, for we assume all newborn biomass recruits to the smallest size-class.

The energy available for growth for a given size-class $i$ is: 
\begin{equation}
\nu_i = \lambda I_i - T_i,
\end{equation}
where $\lambda$ is the food assimilation efficiency ($g_i$ $g_j^{-1}$), $I$ is the biomass consumed ($g_j$ $g_i$ $d^{-1}$) and $T$ is biomass-specific metabolic costs ($g_i$ $g_i^{-1}$ $d^{-1}$). The energy available for somatic growth is:
\begin{equation}
\gamma_i = \frac{\nu_i - \frac{1}{\kappa_i}d_i}{1-z_i^{(1-d_i) / (\kappa_i \nu_i)}},
\end{equation}
where $d_i$ is the natural mortality rate of size-class $i$ ($g_i$ $g_i^{-1}$ $d^{-1}$) and $z_i$ is the ratio of the initial and the final body size that a particular life stage encompasses and hence reflects the size range that an individual has to grow through before maturing to the next stage.


\subsubsection*{Consumption}
Consumption of prey biomass, for each group, is calculated using a multi-prey Type II feeding function:
\begin{equation}
I_i = \sum_{j \in J} \frac{a_i B_j^t \phi_{ij}}{1+a_i \tau_i \sum_j^N B_j^t \phi_{ij}},
\end{equation}
where we for the sake of generality, we use the index $i$ to identify any size-class from any group, and $j$ its prey which is in the set $J$, which depends on the predator (and group that that predator belongs too). $a_i$ is the size-class specific per unit body-mass search rate ($m^2$ $d^{-1}$ $g_i^{-1}$), $\tau_i$ is the time it takes for one individual of size-class $i$, in terms of body-weight, to digest a unit of biomass of prey $j$ ($d$ $g_j$ $g_i^{-1}$). Here, $j$ indexes all size-classes in all groups, and it is a diet-preference factor $\phi_{ij}$ that determines how much of any given prey, piscivore $i$ eats. 

The diet set $J$ varies greatly amongst the groups. For the piscivore the set $J$ encompasses all groups: piscivore (hence it is carnivorous), planktivore, detrivore and zooplankton. The planktivore size-classses only eat zooplankton. The detrivore size-classes are carnivorous and also eats benthic detrital matter, which is modeled explicitly:
\begin{equation}
W^{t+1} = W^t + Det - Sed - \sum_i^{\tilde{N}} I_i,
\end{equation}
where $W$ is the biomass pool of detrital matter on the sea-floor ($g$ $m^{-2}$), $D$ is the flux of detrital matter from the water column ($g$ $m^{-2}$ $d^{-1}$; this is given by COBALT as an offline component), $S$ is the rate of sedimentation of this biomass ($g$ $m^{-2}$ $d^{-1}$; again a rate given by COBALT) and $I_i$ is the consumption by the detritivore of size-class $i$ of which there are $\tilde{N}$. 



\subsubsection*{Demographic Parameters}
The parameters of the size-structured model are: the minimum and maximum size-classes for each group, the fraction of biomass that is used for somatic growth $\kappa_i$, the natural mortality rate $d$, the rate at which biomass is lost due to metabolic costs $T$, the diet preference of each size class in each group $\phi_{ij}$, the areal search rate $a_i$ (which is also the diffusivity used in modeling movement, and the per unit biomass handling time $\tau_i$.

We assume that medium and large zooplankton are each defined by a unique and discrete body-size: $2mm$ and $20mm$ equivalent spherical diameter (ESD) respectively. Using the following empirical relationship for dry weight ($DW$): $ln(DW) = Ð 2.96 + 2.73 ln(ESD)$ (McCauley et al. 1984), we estimate the body mass ($g$) for medium and large zooplankton. These values are then used in the construction of $\phi_{ij}$ to identify which fish size classes eat zooplankton. 

The areal search rate $a_i$ ($m^2$ $day^{-1}$ $g^{-1}$) was determined using a mechanistic relationship between body size and visual search radius: $a_i = \omega_i L_i \nu_i / s_i$, where $\omega$ is the fraction of time spent hunting for food, $L_i$ and $\nu_i$ are the length ($m$) and swimming speed ($m$ $day^{-1}$) of size class $i$ respectively. Body lengths are calculated from the empirical relationship: $L_i = (s_i / 0.025)^{(1/3)} / 100$. Swimming speeds are taken from Megrey et al. 2007...

Handling times ($days$) between all pairs of size classes are calculated using a relationship between predator and prey body size developed by (Rall et al. 2012): $\tau_{ij} = t_0 s_i^{.83} s_j^{0.5}$, where $t_0$ is a constant determined from empirical data ($93.69$ $days$). The assimilation efficiency $\lambda = 0.7$ accounts for many individual level processes, for example egestion. 

Diet preferences are defined using empirical predator-prey mass ratios (PPMRs). Specifically, $PPMR$ values are taken from the empirical gut-content analysis of Barnes et al. 2010, who defined a mean PPMR $\psi = 3$, with a PPMR standard deviation $\sigma = 1.3$. Similar to Blanchard et al. 2009, $\phi_{ij}$ values were then assumed to be a Gaussian function of the logarithm of predator and prey body masses, $\hat{s_i}$ and $\hat{s_j}$ respectively, with a maximum value when the PPMR is $\psi$ and a standard deviation $\sigma$: $\phi_{ij} = 1/(\sigma \sqrt{2 \pi})\cdot exp(-(\hat{s_i} - \hat{s_j} - \psi) / 2\sigma^2)$ when $\hat{s_i} - \hat{s_j} > 0$, otherwise $\phi_{ij} = 0$. 



\subsubsection*{Space and Movement}
Following Watson et al. 2015, we implement a simple gradient ascent approach to model the active movement of fish biomass. First, in each grid-cell and for each size-class in all groups we calculate the gradient of prey biomass. We then assume that all size-classes of all groups swim/move in the direction of the steepest positive gradient, i.e. they essentially follow food. They move with speed $a_{i,m} = \nu_i + U_m$, where $U_m$ is the zonal or meridional ocean current speed depending on which direction fish are swimming. With this swimming speed we employ a XXX numerical advection-diffusion scheme to model active movement:
%\begin{equation}
%B_{mn}^{t+1} = B^{-}_{mn} + B^{+}_{mn}
%\end{equation}
Diffusion is solved for using a 2D Forward in Time Centered Scheme:
% http://pauli.uni-muenster.de/tp/fileadmin/lehre/NumMethoden/WS0910/ScriptPDE/Heat.pdf
\begin{equation}
B^{-}_{mn} = \alpha (B_{m+1n}^{*} + B_{m-1n}^{*}) + \beta (B_{mn+1}^{*} + B_{mn-1}^{*}) + (1-2\alpha-2\beta) B_{ij}^*,
\end{equation}
where $\alpha = D \Delta t / \Delta x^2$ and $\beta = D \Delta t / \Delta y^2$. Advection is solved for using a 2D Lax-Wendroff directional splitting (where the meridional and zonal directions are computed sequentially) scheme, first in the zonal direction:
% http://www.lancs.ac.uk/~winterh/advectionCS.pdf
\begin{align}
B^+_{mn} = &B_{mn}^- - \frac{U}{2}(B_{m+1n}^- - B_{m-1n}^-) - \frac{U^2}{2}(B_{m+1n}^- - 2 B_{mn}^- + B_{m-1n}^-),
\end{align}
then in the meridional direction:
\begin{align}
B^{t+1}_{mn} = &B_{mn}^+ - \frac{V}{2}(B_{mn+1}^+ - B_{mn-1}^+) - \frac{V^2}{2}(B_{mn+1}^+ - 2 B_{mn}^+ + B_{mn-1}^+)
\end{align}



where $U = u \Delta t / \Delta x$ and $V = u \Delta t / \Delta x$.

If all resource gradients are negative then that predator size-class is at a local resource maxima and we treat this case slightly differently. Here, we assume that fish will swim against all ocean currents and try to maintain their position at this maxima. We model this as follows:
\begin{equation}
a_i = sgn(U_m) \cdot max(|U_m| - \nu_i, 0),
\end{equation}
where the $sgn(\cdot)$ operator finds the sign of its input, and $|\cdot|$ is the absolute value operator. Essentially, if fish want to stay a given location, and can swim faster than the local ocean currents, then they do not move.

\subsubsection*{Numerical Integration and Off-line Coupling}
We have posed our model as multiple systems of ordinary differential equations; a size-based demographic system at each spatial grid cell linked by movement, being forced off-line by vertically integrated zooplankton biomass fields and vertically averaged zooplankton mortality fields. To step the model forward in time we split the operations; solving the demographics first, then movement. Both processes are calculated using a simple forward-Euler scheme, integrated forward at a daily resolution. At this temporal scale, and at the spatial scales of the global model grid, $\sim$1 degree latitude/longitude the forward-Euler scheme is stable.

The size-based food-web model is initialized by running it forward in time from 1948 to 2008 and looped repeatedly, until a quasi-equilibrium state is reached. Typically three loops were required. Looping from 2008 back to 1948 does incur a significant shock to the dynamics, and thus our analyses are confined to the period 1997 -- 2007. By this time the transient dynamics produced from the shock have dissipated \citep{Stock:2013ek}. 

The size-based food web model and zooplankton fields from COBALT are coupled in a specific manner to ensure energy constraints are met. The critical consideration is that the rate at which fish consume zooplankton can differ between the size-structured food-web model and COBALT. Since COBALT has been calibrated to produce realistic zooplankton consumption rates \citep{Stock:2013ek} we tune the size-structured model to its values. We allow the size-structured model to produce zooplankton consumption rates less than those produced from COBALT,  assuming that unresolved sources of zooplankton mortality, for example predation of adults on early life stages, account for the difference \citep{Ohman:2001fl}. However, where the size-structured model rates are greater than those of COBALT's, we actively reduce them so that mass is conserved. We do so as follows. Consider medium and large zooplankton as indexed by $m$ and $l$ respectively. At each time step, we calculate how much zooplankton is consumed by each size-class $i$ at a given location in time (i.e. using Eq. 2): $B_i C_{im}$ and $B_i C_{il}$. If $\sum_i B_i C_{im}$ and $\sum_i B_i C_{il}$ are greater than COBALT's medium and large zooplankton mortality rates respectively, we rescale zooplankton consumption rates for each size-class such that the total amount of zooplankton consumed equals the COBALT mortality terms. This rescaling is done in order of zooplankton consumption rates; i.e. size classes that eat more zooplankton have their consumption rates reduced proportionally. 





\end{document}














